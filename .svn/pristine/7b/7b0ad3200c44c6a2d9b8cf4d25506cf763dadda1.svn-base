define(["knockout","jquery","text!./../templates/AddTask.html","core","../../widgets/start"],function(e,t,n,r,i){var s=function(e,t,n){if(e==""||t==""||n=="")return!0;var r=new Date(parseInt(n,10),parseInt(t,10)-1,parseInt(e,10));return isNaN(r.getTime())||r.getDate()!=e||r.getMonth()+1!=t||r.getFullYear()!=n},o=function(e,t,n){return e==""&&t==""&&n==""?null:n+"-"+t+"-"+e},u=function(e,t,n,r){if(e){var i=new Date(e);t(i.getDate()),n(i.getMonth()+1),r(i.getFullYear())}};return function(t){var a=this;a.title=e.observable(t.title).extend({required:!0}),a.reminder=e.observable(t.reminder),a.reminderList=t.jsonValues.reminder,a.members=t.jsonValues.members,a.linkTo=e.observable(t.linkTo),a.complete=e.observable(t.complete),a.procents=t.jsonValues.complete,a.startMonth=e.observable(""),a.startDay=e.observable(""),a.startYear=e.observable(""),u(t.startDate,a.startDay,a.startMonth,a.startYear),a.dueMonth=e.observable(""),a.dueDay=e.observable(""),a.dueYear=e.observable(""),u(t.dueDate,a.dueDay,a.dueMonth,a.dueYear),a.startDateInvalid=e.computed(function(){return s(a.startDay(),a.startMonth(),a.startYear())}),a.dueDateInvalid=e.computed(function(){return s(a.dueDay(),a.dueMonth(),a.dueYear())}),a.dueDate=e.computed(function(){return o(a.dueDay(),a.dueMonth(),a.dueYear())}),a.startDate=e.computed(function(){return o(a.startDay(),a.startMonth(),a.startYear())}),a.dateDeaposonInvalid=e.computed(function(){if(a.dueDateInvalid()||a.startDateInvalid())return!1;var e=a.startDay(),t=a.startMonth(),n=a.startYear(),r=a.dueDate(),i=a.dueMonth(),s=a.dueYear();if(e==""||t==""||n==""||r==""||i==""||s=="")return!1;var o=new Date(parseInt(n,10),parseInt(t,10)-1,parseInt(e,10)),u=new Date(parseInt(s,10),parseInt(i,10)-1,parseInt(r,10));return u<o}),a.notes=e.observable(new i.Notes(t.notes)),a.errors=e.validation.group(a),a.saveTask=function(){var e=a.notes().getNotes(),n={title:a.title(),startDate:a.startDate(),dueDate:a.dueDate(),complete:a.complete(),reminder:a.reminder(),notes:e,linkTo:a.linkTo()};t.id&&(n.id=t.id),a.errors().length!=0?a.errors.showAllMessages():a.startDateInvalid()==0&&a.dueDateInvalid()==0&&a.dateDeaposonInvalid()==0&&r.ajax_post("/task/add",n,function(){window.location="#/tasks"})},a.memberName=function(e){return e.firstName+" "+e.lastName},a.errors=e.validation.group(a),a.template=n}})