define(["knockout","jquery","text!./../templates/Register1.html","core","vent"],function(e,t,n,r,i){var s=function(e,t,n,r){if(r&&e==""&&t==""&&n=="")return!1;if(e==""||t==""||n=="")return!0;var i=new Date(parseInt(n,10),parseInt(t,10)-1,parseInt(e,10));return isNaN(i.getTime())||i.getDate()!=e||i.getMonth()+1!=t||i.getFullYear()!=n},o=function(e,t,n){return e==""&&t==""&&n==""?null:n+"-"+t+"-"+e};return function(){var t=this,u={firstName:e.observable("").extend({required:!0,minLength:2,maxLength:30}),lastName:e.observable("").extend({required:!0,minLength:2,maxLength:30}),address1:e.observable("").extend({maxLength:30}),address2:e.observable("").extend({maxLength:30}),address3:e.observable("").extend({maxLength:20}),email:e.observable("").extend({required:!0,email:{message:"please use valid email address"},minLength:2,maxLength:80}),occupation:e.observable("").extend({required:!0}),postcode1:e.observable("").extend({required:!0}),postcode2:e.observable("").extend({required:!0}),occupation:e.observable("").extend({required:!0,minLength:2,maxLength:30}),username:e.observable("").extend({required:!0,minLength:2,maxLength:30}),password:e.observable("").extend({required:!0,minLength:6,maxLength:30}),day:e.observable(""),month:e.observable(""),year:e.observable("")};u.dateInvalid=e.computed(function(){return s(u.day(),u.month(),u.year(),!0)}),t.user=e.validatedObservable(u),t.fistTime=e.observable(!1),t.code1=e.observable(""),t.code2=e.observable(""),t.code3=e.observable(""),t.code4=e.observable(""),t.agree=e.observable(!1),t.activateError=e.observable(""),t.exit=function(){i.trigger("logout")},t.getCode=function(){if(t.user.errors().length!=0)t.fistTime(!0),t.user.errors.showAllMessages();else{var n=e.toJS(t.user);n.address=n.address1+n.address2+n.address3,n.postcode=n.postcode1+n.postcode2;var i=new Date,s=i.getTimezoneOffset();n.timezone=s,delete n.address1,delete n.address2,delete n.address3,delete n.postcode1,delete n.postcode2,delete n.errors,n.dateOfBirthday=o(n.day,n.month,n.year),delete n.day,delete n.month,delete n.year,delete n.dateInvalid,r.ajax_post("/api/registration/sendActivationCode",n,function(e){e.jsonValues.success?alert("Activation code has been sent to "+t.user().email()):alert("ERORR : "+e.jsonValues.message)})}},t.showTerms=function(){i.trigger("showTerms")},t.activate=function(){if(t.agree()==0)return;var e=t.code1()+"-"+t.code2()+"-"+t.code3()+"-"+t.code4();r.ajax_post("/api/registration/activate",{activationCode:e},function(e){e.jsonValues.success?i.trigger("update_state","register1"):t.activateError(e.jsonValues.message||"")})},t.template=n}})