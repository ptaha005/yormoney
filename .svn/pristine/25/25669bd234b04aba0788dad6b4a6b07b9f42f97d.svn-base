(function(e){typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?e(require("knockout"),exports):typeof define=="function"&&define.amd?define(["knockout","exports"],e):e(ko,ko.mapping={})})(function(e,t){function h(e,t){var n={};for(var r=e.length-1;r>=0;--r)n[e[r]]=e[r];for(var r=t.length-1;r>=0;--r)n[t[r]]=t[r];var i=[];for(var s in n)i.push(n[s]);return i}function p(e,n){for(var r in n)if(n.hasOwnProperty(r)&&n[r])if(r&&e[r]&&t.getType(e[r])!=="array")p(e[r],n[r]);else{var i=t.getType(e[r])==="array"&&t.getType(n[r])==="array";i?e[r]=h(e[r],n[r]):e[r]=n[r]}}function d(e,t){var n={};return p(n,e),p(n,t),n}function v(e,t){var n=d({},e);for(var r=a.length-1;r>=0;r--){var i=a[r];if(!n[i])continue;n[""]instanceof Object||(n[""]={}),n[""][i]=n[i],delete n[i]}return t&&(n.ignore=m(t.ignore,n.ignore),n.include=m(t.include,n.include),n.copy=m(t.copy,n.copy)),n.ignore=m(n.ignore,c.ignore),n.include=m(n.include,c.include),n.copy=m(n.copy,c.copy),n.mappedProperties=n.mappedProperties||{},n}function m(n,r){return t.getType(n)!=="array"&&(t.getType(n)==="undefined"?n=[]:n=[n]),t.getType(r)!=="array"&&(t.getType(r)==="undefined"?r=[]:r=[r]),e.utils.arrayGetDistinctValues(n.concat(r))}function g(t,r){var s=e.dependentObservable;e.dependentObservable=function(r,s,o){o=o||{},r&&typeof r=="object"&&(o=r);var u=o.deferEvaluation,a=!1,f=function(r){var s=e.dependentObservable;e.dependentObservable=i;var o=e.isWriteableObservable(r);e.dependentObservable=s;var u=i({read:function(){return a||(e.utils.arrayRemoveItem(t,r),a=!0),r.apply(r,arguments)},write:o&&function(e){return r(e)},deferEvaluation:!0});return n&&(u._wrapper=!0),u};o.deferEvaluation=!0;var l=new i(r,s,o);return u||(l=f(l),t.push(l)),l},e.dependentObservable.fn=i.fn,e.computed=e.dependentObservable;var o=r();return e.dependentObservable=s,e.computed=e.dependentObservable,o}function y(n,i,s,a,l,c,h){var p=t.getType(e.utils.unwrapObservable(i))==="array";c=c||"";if(t.isMapped(n)){var v=e.utils.unwrapObservable(n)[r];s=d(v,s)}var m={data:i,parent:h},w=function(){return s[a]&&s[a].create instanceof Function},N=function(t){return g(o,function(){return e.utils.unwrapObservable(l)instanceof Array?s[a].create({data:t||m.data,parent:m.parent,skip:f}):s[a].create({data:t||m.data,parent:m.parent})})},C=function(){return s[a]&&s[a].update instanceof Function},k=function(t,n){var r={data:n||m.data,parent:m.parent,target:e.utils.unwrapObservable(t)};return e.isWriteableObservable(t)&&(r.observable=t),s[a].update(r)},L=u.get(i);if(L)return L;a=a||"";if(!p)if(!T(i))switch(t.getType(i)){case"function":C()?e.isWriteableObservable(i)?(i(k(i)),n=i):n=k(i):n=i;break;default:if(e.isWriteableObservable(n)){if(C()){var A=k(n);return n(A),A}var A=e.utils.unwrapObservable(i);return n(A),A}return w()?(n=N(),n):(n=e.observable(e.utils.unwrapObservable(i)),n)}else{n=e.utils.unwrapObservable(n);if(!n){if(w()){var O=N();return C()&&(O=k(O)),O}if(C())return k(O);n={}}C()&&(n=k(n)),u.save(i,n);if(C())return n;x(i,function(t){var r=c.length?c+"."+t:t;if(e.utils.arrayIndexOf(s.ignore,r)!=-1)return;if(e.utils.arrayIndexOf(s.copy,r)!=-1){n[t]=i[t];return}var o=u.get(i[t]),a=y(n[t],i[t],s,t,n,r,n),f=o||a;e.isWriteableObservable(n[t])?n[t](e.utils.unwrapObservable(f)):n[t]=f,s.mappedProperties[r]=!0})}else{var M=[],_=!1,D=function(e){return e};s[a]&&s[a].key&&(D=s[a].key,_=!0),e.isObservable(n)||(n=e.observableArray([]),n.mappedRemove=function(e){var t=typeof e=="function"?e:function(t){return t===D(e)};return n.remove(function(e){return t(D(e))})},n.mappedRemoveAll=function(t){var r=S(t,D);return n.remove(function(t){return e.utils.arrayIndexOf(r,D(t))!=-1})},n.mappedDestroy=function(e){var t=typeof e=="function"?e:function(t){return t===D(e)};return n.destroy(function(e){return t(D(e))})},n.mappedDestroyAll=function(t){var r=S(t,D);return n.destroy(function(t){return e.utils.arrayIndexOf(r,D(t))!=-1})},n.mappedIndexOf=function(t){var r=S(n(),D),i=D(t);return e.utils.arrayIndexOf(r,i)},n.mappedCreate=function(t){if(n.mappedIndexOf(t)!==-1)throw new Error("There already is an object with the key that you specified.");var r=w()?N(t):t;if(C()){var i=k(r,t);e.isWriteableObservable(r)?r(i):r=i}return n.push(r),r});var P=S(e.utils.unwrapObservable(n),D).sort(),H=S(i,D);_&&H.sort();var B=e.utils.compareArrays(P,H),j={},F,I,q=e.utils.unwrapObservable(i),R={},U=!0;for(F=0,I=q.length;F<I;F++){var z=D(q[F]);if(z===undefined||z instanceof Object){U=!1;break}R[z]=q[F]}var W=[],X=0;for(F=0,I=B.length;F<I;F++){var z=B[F],V,$=c+"["+F+"]";switch(z.status){case"added":var J=U?R[z.value]:E(e.utils.unwrapObservable(i),z.value,D);V=y(undefined,J,s,a,n,$,l),w()||(V=e.utils.unwrapObservable(V));var K=b(e.utils.unwrapObservable(i),J,j);V===f?X++:W[K-X]=V,j[K]=!0;break;case"retained":var J=U?R[z.value]:E(e.utils.unwrapObservable(i),z.value,D);V=E(n,z.value,D),y(V,J,s,a,n,$,l);var K=b(e.utils.unwrapObservable(i),J,j);W[K]=V,j[K]=!0;break;case"deleted":V=E(n,z.value,D)}M.push({event:z.status,item:V})}n(W),s[a]&&s[a].arrayChanged&&e.utils.arrayForEach(M,function(e){s[a].arrayChanged(e.event,e.item)})}return n}function b(e,t,n){for(var r=0,i=e.length;r<i;r++){if(n[r]===!0)continue;if(e[r]===t)return r}return null}function w(n,r){var i;return r&&(i=r(n)),t.getType(i)==="undefined"&&(i=n),e.utils.unwrapObservable(i)}function E(t,n,r){t=e.utils.unwrapObservable(t);for(var i=0,s=t.length;i<s;i++){var o=t[i];if(w(o,r)===n)return o}throw new Error("When calling ko.update*, the key '"+n+"' was not found!")}function S(t,n){return e.utils.arrayMap(e.utils.unwrapObservable(t),function(e){return n?w(e,n):e})}function x(e,n){if(t.getType(e)==="array")for(var r=0;r<e.length;r++)n(r);else for(var i in e)n(i)}function T(e){var n=t.getType(e);return(n==="object"||n==="array")&&e!==null}function N(e,n,r){var i=e||"";return t.getType(n)==="array"?e&&(i+="["+r+"]"):(e&&(i+="."),i+=r),i}function C(){var t=[],n=[];this.save=function(r,i){var s=e.utils.arrayIndexOf(t,r);s>=0?n[s]=i:(t.push(r),n.push(i))},this.get=function(r){var i=e.utils.arrayIndexOf(t,r),s=i>=0?n[i]:undefined;return s}}function k(){var e={},t=function(t){var n;try{n=t}catch(r){n="$$$"}var i=e[n];return i===undefined&&(i=new C,e[n]=i),i};this.save=function(e,n){t(e).save(e,n)},this.get=function(e){return t(e).get(e)}}var n=!0,r="__ko_mapping__",i=e.dependentObservable,s=0,o,u,a=["create","update","key","arrayChanged"],f={},l={include:["_destroy"],ignore:[],copy:[]},c=l;t.isMapped=function(t){var n=e.utils.unwrapObservable(t);return n&&n[r]},t.fromJS=function(e){if(arguments.length==0)throw new Error("When calling ko.fromJS, pass the object you want to convert.");window.setTimeout(function(){s=0},0),s++||(o=[],u=new k);var t,n;arguments.length==2&&(arguments[1][r]?n=arguments[1]:t=arguments[1]),arguments.length==3&&(t=arguments[1],n=arguments[2]),n&&(t=d(t,n[r])),t=v(t);var i=y(n,e,t);return n&&(i=n),--s||window.setTimeout(function(){while(o.length){var e=o.pop();e&&e()}},0),i[r]=d(i[r],t),i},t.fromJSON=function(n){var r=e.utils.parseJson(n);return arguments[0]=r,t.fromJS.apply(this,arguments)},t.updateFromJS=function(e){throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!")},t.updateFromJSON=function(e){throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!")},t.toJS=function(n,i){c||t.resetDefaultOptions();if(arguments.length==0)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if(t.getType(c.ignore)!=="array")throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if(t.getType(c.include)!=="array")throw new Error("ko.mapping.defaultOptions().include should be an array.");if(t.getType(c.copy)!=="array")throw new Error("ko.mapping.defaultOptions().copy should be an array.");return i=v(i,n[r]),t.visitModel(n,function(t){return e.utils.unwrapObservable(t)},i)},t.toJSON=function(n,r){var i=t.toJS(n,r);return e.utils.stringifyJson(i)},t.defaultOptions=function(){if(!(arguments.length>0))return c;c=arguments[0]},t.resetDefaultOptions=function(){c={include:l.include.slice(0),ignore:l.ignore.slice(0),copy:l.copy.slice(0)}},t.getType=function(e){if(e&&typeof e=="object"){if(e.constructor==(new Date).constructor)return"date";if(Object.prototype.toString.call(e)==="[object Array]")return"array"}return typeof e},t.visitModel=function(n,i,s){s=s||{},s.visitedObjects=s.visitedObjects||new k;var o,u=e.utils.unwrapObservable(n);if(!T(u))return i(n,s.parentName);s=v(s,u[r]),i(n,s.parentName),o=t.getType(u)==="array"?[]:{},s.visitedObjects.save(n,o);var a=s.parentName;return x(u,function(n){if(s.ignore&&e.utils.arrayIndexOf(s.ignore,n)!=-1)return;var f=u[n];s.parentName=N(a,u,n);if(e.utils.arrayIndexOf(s.copy,n)===-1&&e.utils.arrayIndexOf(s.include,n)===-1&&u[r]&&u[r].mappedProperties&&!u[r].mappedProperties[n]&&t.getType(u)!=="array")return;var l;switch(t.getType(e.utils.unwrapObservable(f))){case"object":case"array":case"undefined":var c=s.visitedObjects.get(f);o[n]=t.getType(c)!=="undefined"?c:t.visitModel(f,i,s);break;default:o[n]=i(f,s.parentName)}}),o}})