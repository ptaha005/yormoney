(function(e){e.fn.selectbox=function(){e(this).each(function(){var t=e(this);if(t.prev("span.selectbox").length<1){function n(){var n=t.find("option"),r=n.filter(":selected"),s=n.filter(":first").text();r.length&&(s=r.text());var o="";for(i=0;i<n.length;i++){var u="",a=' class="disabled"';n.eq(i).is(":selected")&&(u=' class="selected sel"'),n.eq(i).is(":disabled")&&(u=a),o+="<li"+u+">"+n.eq(i).text()+"</li>"}var f=e('<span class="selectbox" style="display:inline-block;position:relative"><div class="select" style="float:left;position:relative;z-index:51"><div class="text">'+s+"</div>"+'<b class="trigger"><i class="arrow"></i></b>'+"</div>"+'<div class="dropdown" style="position:absolute;z-index:50;overflow:auto;overflow-x:hidden;list-style:none">'+"<ul>"+o+"</ul>"+"</div>"+"</span>");t.before(f).css({position:"absolute",top:-9999});var l=f.find("div.select"),c=f.find("div.text"),h=f.find("div.dropdown"),p=h.find("li"),d=f.outerHeight();h.css("left")=="auto"&&h.css({left:0}),h.css("top")=="auto"&&h.css({top:d});var v=p.outerHeight(),m=h.css("top");h.hide(),l.click(function(){var t=f.offset().top,n=e(window).height()-d-(t-e(window).scrollTop());return n<0||n<v*6?(h.height("auto").css({top:"auto",bottom:m}),h.outerHeight()>t-e(window).scrollTop()-20&&h.height(Math.floor((t-e(window).scrollTop()-20)/v)*v)):n>v*6&&(h.height("auto").css({bottom:"auto",top:m}),h.outerHeight()>n-20&&h.height(Math.floor((n-20)/v)*v)),e("span.selectbox").css({zIndex:1}).removeClass("focused"),f.css({zIndex:2}),h.is(":hidden")?(e("div.dropdown:visible").hide(),h.show()):h.hide(),!1}),p.hover(function(){e(this).siblings().removeClass("selected")});var g=p.filter(".selected").text();p.filter(":not(.disabled)").click(function(){var r=e(this).text();g!=r&&(e(this).addClass("selected sel").siblings().removeClass("selected sel"),n.removeAttr("selected").eq(e(this).index()).attr("selected",!0),g=r,c.text(r),t.change()),h.hide()}),h.mouseout(function(){h.find("li.sel").addClass("selected")}),t.focus(function(){e("span.selectbox").removeClass("focused"),f.addClass("focused")}).keyup(function(){c.text(n.filter(":selected").text()),p.removeClass("selected sel").eq(n.filter(":selected").index()).addClass("selected sel")}),e(document).on("click",function(t){e(t.target).parents().hasClass("selectbox")||(h.hide().find("li.sel").addClass("selected"),f.removeClass("focused"))})}n(),t.on("refresh",function(){t.prev().remove(),n()})}})}})(jQuery)