define(["knockout","jquery","text!./../../templates/ProductInfoTabs/Documents.html","vent","ko.mapping","../../../widgets/start","core","qq","jquery-ui"],function(e,t,n,r,i,s,o,u){function a(){var e=t("#red").slider("value");t("#folder-inner").css("left",-e+"px")}return e.observableArray.fn.pushAll=function(t){var n=this();return this.valueWillMutate(),e.utils.arrayPushAll(n,t),this.valueHasMutated(),this},function(i){var f=this;f.notes=e.observable(new s.Notes(i.insurance.notes||[])),f.selectedFolderId=e.observable(""),r.on("deleteFileOrFolder",function(){if(!confirm("are your sure?"))return;f.selectedFileId()!=""?o.ajax_delete("/user/file?fileId="+f.selectedFileId(),function(){var t=e.utils.arrayFirst(f.files(),function(e){return e.id==f.selectedFileId()});f.files.remove(t)}):o.ajax_delete("/user/folder?folderId="+f.selectedFolderId(),function(e){f.folders.remove(f.selectedFolder()),l()})}),r.on("createFolder",function(){var n=e.observableArray([{id:e.observable("0"),name:e.observable(""),path:"new",template:e.observable("view-edit")}]);n.pushAll(f.folders()),f.folders(n()),t(".folder-name").select(),l()});var l=function(){var e=t("#folder-container").width(),n=103*f.folders().length;t("#folder-inner").width(n+100+"px");var r=n-e;r<0&&(r=0),t("#red").slider("option","max",r),t("#red").slider("value",0)};f.afterRender=function(){t("#red").slider({orientation:"horizontal",range:"min",max:0,value:0,slide:a,change:a}),l(),f.qq=new u.FileUploader({element:t("#photo-upload")[0],action:"/user/uploadFile",params:{path:""},onComplete:function(e,n,r){var i=f.selectedFolderId();i==""&&(i="0"),t.get("/user/file/"+i,f.files),t(".qq-upload-list").hide()},template:'<div class="qq-uploader"><pre class="qq-upload-drop-area"><span></span></pre><div class="qq-upload-button"><button  class="grey_button " type="button" >add file</button></div><ul class="qq-upload-list" style="margin-top: 10px; text-align: center;"></ul></div>'})},f.showVideo=function(){r.trigger("showHowToVidio","income")},f.saveNotes=e.computed(function(){var e=f.notes().getNotes();f.saveNotes&&o.ajax_post("/insurance/notes",e)}),f.calculateSrc=function(e){return e=="report"?"/pages/img/report.png":e=="pfr"?"/pages/img/pfr.png":e=="xls"?"/pages/img/xls.png":"/pages/img/cover.png"},f.folders=e.observableArray(e.utils.arrayMap(i.folders,function(t){return t.id=e.observable(t.id),t.name=e.observable(t.name),t.template=e.observable("view-folder"),t})),f.selectedFolder=e.computed(function(){var t=e.utils.arrayFirst(f.folders(),function(e){return e.id()==f.selectedFolderId()});return t?t:{id:e.observable("0"),name:e.observable("")}}),f.selectFolder=function(e){f.selectedFolderId(e.id()),f.selectedFileId("")},f.unselect=function(){f.selectedFolderId(""),f.selectedFileId("")},f.edit=function(){t("#documents").hasClass("active")||(document.location="#/insurance"),f.folders.push({id:e.observable("0"),name:e.observable(""),path:"new",template:e.observable("view-edit")}),t(".folder-name").select()},f.changeFolder=function(e){o.ajax_post("/user/folder/"+e.name(),{},function(t){t.jsonValues.success?(e.id(t.id),e.template("view-folder")):f.folders.remove(e)})},f.displayMode=function(e){return e.template()},f.files=e.observableArray([]),e.computed(function(){var e=f.selectedFolder();f.qq&&f.qq.setParams({path:e.name()}),t.get("/user/file/"+e.id(),f.files)}),f.selectedFileId=e.observable(""),f.folders().length>0&&f.selectedFolderId(f.folders()[0].id()),f.selectFile=function(e){f.selectedFileId(e.id)},f.downloadFile=function(e){var t=e.path.split("/file"),n="file"+t[1]+e.systemName;window.open(n,"_blank")},f.template=n}})