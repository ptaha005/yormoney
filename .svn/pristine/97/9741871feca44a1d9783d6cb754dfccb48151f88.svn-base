define(["jquery","knockout","vent","ko.mapping","ko.validation"],function(e,t,n,r){t.region=function(r){var i=t.observable(r);return i.render=function(t,r){i()!=null&&i().onRemove&&i().onRemove();if(r&&(typeof r=="string"||r instanceof String))return e.get(r,function(e){i(new t(e)),i()!=null&&i().afterRender&&i().afterRender()}).fail(function(e,t,r,i){n.trigger("error")});i(new t(r)),i()!=null&&i().afterRender&&i().afterRender()},i},t.validation.configure({decorateElement:!0,errorElementClass:"invalid"});var i=function(n,r,i){return r=t.toJSON(r),e.ajax({method:"POST",url:n,contentType:"application/json",data:r,success:i})},s=function(t,n){return e.ajax({url:t,type:"DELETE",success:n})},o=function(n){var s=this;s.autoUpdate=s.autoUpdate||!1;var o={},u={};for(var a in s.fields){var f=s.fields[a];o[a]=f.default,f.validation&&(u[a]=f.validation)}for(var f in n)n[f]||delete n[f];n=e.extend(o,n),r.fromJS(n,{},s);for(var l in u)s[l].extend(u[l]);s.save=function(e){e=e||function(){};var t=r.toJS(s,{ignore:["constructor"]});s.errors().length>0?(s.errors.showAllMessages(),e(null)):i(s.url+"/add",t).done(function(n){t.id?s.constructor.emitor.trigger("update"):(s.id(n.id),s.constructor.emitor.trigger("create")),e(n)}).fail(function(){})},s.delete=function(e){return e=e||function(){},i(s.url+"/delete",{id:s.id},function(t){s.constructor.emitor.trigger("delete"),e(t)})},s.change=t.computed(function(){var e=r.toJS(s,{ignore:["constructor","id"]});s.change&&(s.constructor.emitor.trigger("change"),s.autoUpdate&&s.save())}).extend({throttle:5}),s.errors=t.validation.group(s),this.initialize.apply(this,arguments)},u=function(e,t){return hasOwnProperty.call(e,t)};return o.prototype.initialize=function(){},o.extend=function(t,n){var r=this,i;t&&u(t,"constructor")?i=t.constructor:i=function(){return r.apply(this,arguments)},e.extend(i,r,n);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,t&&e.extend(i.prototype,t),i.__super__=r.prototype,i.emitor=e({}),i},o.on=function(e,t){return this.emitor.on(e,t),this},o.off=function(e){return this.emitor.off(e),this},{ajax_post:i,ajax_delete:s,Model:o}})